<p-table #dt [columns]="columns" [value]="service.header.iipodetail" selectionMode="single" [metaKeySelection]="true"
  [(selection)]="service.selectedDetailRow" [scrollable]="true" scrollHeight="150px" scrollWidth="100%"
  [resizableColumns]="true" [responsive]="true" [resizableColumns]="true" [reorderableColumns]="true" dataKey="srNo">

  <ng-template pTemplate="header">

    <tr>
      <th style="width:3em"> <input pInputText type="text"
          (input)="dt.filter($event.target.value, 'sortOrder','sortOrder'.filterMatchMode)">
      </th>
      <th style="width:10em">
        <input pInputText type="text" (input)="dt.filter($event.target.value, 'itemCode','itemCode'.filterMatchMode)">
      </th>
      <th style="width:20em">
        <input pInputText type="text" (input)="dt.filter($event.target.value, 'itemName','itemName'.filterMatchMode)">
      </th>
      <th style="width:5em"></th>
      <th style="text-align : right; width:10em">
        <input pInputText pKeyFilter="int" type="text"
          (input)="dt.filter($event.target.value, 'itemQty','itemQty'.filterMatchMode)">
      </th>
      <th style="text-align : right;width:10em">
        <input pInputText pKeyFilter="money" type="text"
          (input)="dt.filter($event.target.value, 'baseRate','baseRate'.filterMatchMode)">
      </th>
      <th style="width:10em"></th>
      <th style="text-align : right;width:10em">
        <input pInputText pKeyFilter="money" type="text"
          (input)="dt.filter($event.target.value, 'disPer','disPer'.filterMatchMode)">
      </th>
      <th style="text-align : right;width:10em">
        <input pInputText pKeyFilter="money" type="text"
          (input)="dt.filter($event.target.value, 'disAmt','disAmt'.filterMatchMode)">
      </th>
      <th style="text-align : right;width:10em">
        <input pInputText pKeyFilter="money" type="text"
          (input)="dt.filter($event.target.value, 'addAmt','addAmt'.filterMatchMode)">
      </th>
      <th style="width:10em"></th>
      <th style="width:8em"></th>
      <th style="width:8em"></th>
      <th style="width:8em"></th>
      <th style="width:8em"></th>
      <th style="width:8em"></th>
      <th style="width:7em"></th>
      <th style="width:9em"></th>
      <th style="width:5.5em"></th>
      <th style="width:5.5em"></th>
      <th style="width:5.5em"></th>
      <th style="width:5.5em"></th>
      <th style="width:6.5em"></th>
      <th style="width:6.5em"></th>
      <th style="width:5em"></th>
      <th style="width:7em"></th>
    </tr>

    <tr>
      <th>#</th>

      <th [pSortableColumn]="">{{'iitemCode'| first}}
        <p-sortIcon [field]="'itemCode'" ariaLabel="Activate to sort"
          ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order">
        </p-sortIcon>
      </th>
      <th [pSortableColumn]="">{{'iitemName'| first}} </th>
      <th [pSortableColumn]="">{{'unit'| first}}</th>
      <th [pSortableColumn]="">{{'qty'| first}}</th>
      <th [pSortableColumn]="">{{'itemRate'| first}}</th>
      <th [pSortableColumn]="">{{'amount'| first}}</th>
      <th [pSortableColumn]="">{{'discPer'| first}}</th>
      <th [pSortableColumn]="">{{'discAmt'| first}}</th>
      <th [pSortableColumn]="">{{'addAmt'| first}}</th>
      <th>{{'netAmt'| first}}</th>
      <th [pSortableColumn]="">{{'edDate'| first}}</th>
      <th [pSortableColumn]="">{{'jobCode'| first}}</th>
      <th [pSortableColumn]="">{{'lSumOpen'| first}}</th>
      <th>{{'finalRate'| first}}</th>
      <th>{{'costRate'| first}}</th>
      <th>{{'grvQty'| first}}</th>
      <th>{{'cancelledQty'| first}}</th>
      <th>{{'refCo'| first}}</th>
      <th>{{'refDv'| first}}</th>
      <th>{{'refBr'| first}}</th>
      <th>{{'refInt'| first}}</th>
      <th>{{'refVrNo'| first}}</th>
      <th>{{'refSrNo'| first}}</th>
      <th>{{'srNo'| first}}</th>
      <th>{{'processed'| first}}</th>
    </tr>


  </ng-template>

  <ng-template pTemplate="body" let-rowData let-ri="rowIndex">
    <tr [pSelectableRow]="rowData" [pSelectableRowIndex]="rowIndex">
      <td pEditableColumn style="text-align:center;width:3em;"
        [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <input pInputText type="text" [(ngModel)]="rowData.sortOrder" disabled>
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.sortOrder}}
          </ng-template>
        </p-cellEditor>
      </td>

      <td pEditableColumn style="width:10em" [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <input type="text" pInputText (click)="onItemSelection(ri)" placeholder=" " [(ngModel)]="rowData.itemCode">
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.itemCode}}
          </ng-template>
        </p-cellEditor>
      </td>

      <td style="width:20em">
        <input pInputText type="text" disabled [(ngModel)]="rowData.itemName" style="width: 100%;">
      </td>

      <td pEditableColumn style="width:5em" [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <input type="text" pInputText (click)="onUnitSelection(ri)" placeholder=" " [(ngModel)]="rowData.uom">
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.uom}}
          </ng-template>
        </p-cellEditor>
      </td>

      <td pEditableColumn style="text-align : right;width:10em"
        [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <!-- <input pInputText pKeyFilter="num" type="text" style="text-align : right;" [(ngModel)]="rowData.itemQty"> -->
            <p-inputNumber [(ngModel)]="rowData.itemQty" tyle="text-align : right;"> </p-inputNumber>
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.itemQty }}
            <!-- | number: actionService.ictQty -->
          </ng-template>
        </p-cellEditor>
      </td>

      <td pEditableColumn style="text-align : right;width:10em"
        [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <p-inputNumber [(ngModel)]="rowData.baseRate" (onFocus)="decimalClear(rowData)" [minFractionDigits]="service.rateDecPts" [maxFractionDigits]="service.rateDecPts" mode="decimal" 
            tyle="text-align : right;" > </p-inputNumber>
            <!-- <input pInputText type="num" placeholder=" " service.rateDecPts" [maxFractionDigits]="service.rateDecPts style="text-align : right;" [(ngModel)]="rowData.baseRate"> -->
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.baseRate | number: actionService.ictRate}}
          </ng-template>
        </p-cellEditor>
      </td>

      <td style="text-align : right;width:10em">
        {{rowData.itemQty * rowData.baseRate | number: actionService.ictAmount }}
      </td>

      <td pEditableColumn style="text-align : right;width:10em"
        [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <p-inputNumber [(ngModel)]="rowData.disPer" tyle="text-align : right;"
              (ngModelChange)="changeDetailDiscount(ri,'P')" [minFractionDigits]="service.rateDecPts"
              [maxFractionDigits]="service.rateDecPts" [maxlength]="18 " mode="decimal">
            </p-inputNumber>
            <!-- <input pInputText pKeyFilter="num" type="text" style="text-align : right;" [(ngModel)]="rowData.disPer"
              (ngModelChange)="changeDetailDiscount(ri,'P')"> -->

          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.disPer | number: actionService.ictAmount }}
          </ng-template>
        </p-cellEditor>
      </td>

      <td pEditableColumn style="text-align : right;width:10em"
        [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <p-inputNumber [(ngModel)]="rowData.disAmt" tyle="text-align : right;"
              (ngModelChange)="changeDetailDiscount(ri,'A')" [minFractionDigits]="service.amtDecPts"
              [maxFractionDigits]="service.amtDecPts" [maxlength]="18 " mode="decimal">
            </p-inputNumber>
            <!-- <input pInputText pKeyFilter="num" type="text" style="text-align : right;" [(ngModel)]="rowData.disAmt"
              (change)="changeDetailDiscount(ri,'A')"> -->
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.disAmt | number: actionService.ictAmount }}
          </ng-template>
        </p-cellEditor>
      </td>

      <td pEditableColumn style="text-align : right;width:10em"
        [ngClass]="rowData==service.selectedDetailRow?'editable':null">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <p-inputNumber [(ngModel)]="rowData.addAmt" tyle="text-align : right;"
              [minFractionDigits]="service.amtDecPts" [maxFractionDigits]="service.amtDecPts" [maxlength]="18"
              mode="decimal">
            </p-inputNumber>

            <!-- <input pInputText pKeyFilter="num" type="number" style="text-align : right;" [(ngModel)]="rowData.addAmt"> -->
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.addAmt | number: actionService.ictAmount }}
          </ng-template>
        </p-cellEditor>
      </td>

      <td style="text-align : right;width:10em">
        {{ (convertToFloat((rowData.itemQty * rowData.baseRate) - rowData.disAmt ) + convertToFloat(rowData.addAmt)) |
        number: actionService.ictAmount }}
      </td>
      <td style="width:8em">
        <ng-template pTemplate="input">
          <input pInputText type="date" [(ngModel)]="service.header.edd">
        </ng-template>
        <ng-template pTemplate="output">
          {{rowData.edd | date: 'dd/MM/yyyy'}}
        </ng-template>
        <!-- <p-calendar dateFormat="dd/mm/yy" [(ngModel)]="service.header.edd">
        </p-calendar> -->
        <!-- <ng-template pTemplate="output">
          {{rowData.edd}}
        </ng-template> -->
      </td>
      <td pEditableColumn style="width:8em">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <input pInputText pKeyFilter="num" (click)="onJobSelection(ri)" type="text" [(ngModel)]="rowData.jobCode">
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.jobCode}}
          </ng-template>
        </p-cellEditor>
      </td>
      <td pEditableColumn style="width:8em">
        <p-cellEditor>
          <ng-template pTemplate="input">
            <p-dropdown [options]="lumpSumLovData" [(ngModel)]="rowData.lumpSum" appendTo="body"></p-dropdown>
          </ng-template>
          <ng-template pTemplate="output">
            {{rowData.lumpSum=='Q'?'Quantity': rowData.lumpSum=='L'?'Lump Sum':'Open'}}
          </ng-template>
        </p-cellEditor>
      </td>

      <td style="text-align : right;width:8em">
        {{rowData.itemRate | number: actionService.ictRate}}
      </td>

      <td style="text-align : right;width:8em">
        {{rowData.costRate | number: actionService.ictRate}}
      </td>

      <td style="text-align : right;width:7em">
        {{rowData.grvQty| number: actionService.ictQty}}
      </td>

      <td style="text-align : right;width:9em">
        {{rowData.cnclQty | number: actionService.ictQty}}
      </td>

      <td style="width:5.5em">
        {{rowData.refCo}}
      </td>

      <td style="width:5.5em">
        {{rowData.refDv}}
      </td>

      <td style="width:5.5em">
        {{rowData.refBr}}
      </td>

      <td style="width:5.5em">
        {{rowData.refInt}}
      </td>
      <td style="width:6.5em">
        {{rowData.refVrNo}}
      </td>

      <td style="width:6.5em">
        {{rowData.refSrNo }}
      </td>

      <td style="width:5em">
        {{rowData.srNo}}
      </td>

      <td style="text-align : right;width:6em">
        {{rowData.retQty| number: actionService.ictQty}}
      </td>
    </tr>
  </ng-template>
  <ng-template pTemplate="footer">
    <tr>
      <th style="width:3em"> </th>
      <th style="width:10em"> </th>
      <th style="width:20em"> </th>
      <th style="width:5em"> </th>
      <th style="width:10em"> </th>
      <th style="width:10em"> </th>
      <th style="width:10em">
        <input type="text" disabled value='{{getTotalAmount() | number: actionService.ictAmount }}'
          style="text-align : right;width: 100%;">
      </th>
      <th style="width :10em"> </th>
      <th style="width:10em">
        <input type="text" disabled value='{{getDiscTotal() | number: actionService.ictAmount }}'
          style="text-align : right;width: 100%;">
      </th>
      <th style="width:10em">
        <input type="text" disabled value='{{getAddAmtTotal() | number: actionService.ictAmount }}'
          style="text-align : right;width: 100%;">
      </th>
      <th style="width:10em">
        <input type="text" disabled value='{{getNetTotal() | number: actionService.ictAmount }}'
          style="text-align : right;width: 100%;">
      </th>
      <th style="width :8em"> </th>
      <th style="width:8em"> </th>
      <th style="width:5em"> </th>
      <th style="width:8em"> </th>
      <th style="width:8em"> </th>
      <th style="width:7em"> </th>
      <th style="width:9em"> </th>
      <th style="width:5.5em"> </th>
      <th style="width:5.5em"> </th>
      <th style="width:5.5em"> </th>
      <th style="width:5.5em"> </th>
      <th style="width:6.5em"> </th>
      <th style="width:6.5em"> </th>
      <th style="width:5em"> </th>
      <th style="width:7em"> </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="emptymessage" let-columns>
    <tr>
      <td [attr.colspan]="columns.length">
        No records found
      </td>
    </tr>
  </ng-template>


</p-table>